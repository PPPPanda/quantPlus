# Phase 4 Round 4: B03 止损 Buffer 参数化

## 目标
将硬编码止损 buffer ±1 替换为动态 buffer = max(pricetick, atr × pct)，搜索最优 pct。

## 方法
- 基于 Round 3 最优参数（act=2.5, trail=3.0, cooldown_losses=4, cooldown_bars=30）
- 搜索 pct: [0.00, 0.02, 0.03, 0.05, 0.07, 0.10, 0.15, 0.20]
- pricetick=2（棕榈油最小变动价位），所以 pct=0 时 buffer=2

## 结果

| pct | p2601 | p2405 | p2209 | 合计 | 备注 |
|-----|-------|-------|-------|------|------|
| 0.00 | +3519 | -3052 | +5442 | +5909 | buffer=pricetick=2 |
| 0.02 | +3519 | -3052 | +5442 | +5909 | 同上(atr*0.02<2) |
| 0.03 | +3519 | -3052 | +5442 | +5909 | 同上 |
| 0.05 | +3519 | -3052 | +4882 | +5349 | 开始退化 |
| 0.07 | +3519 | -3052 | +4562 | +5029 | |
| 0.10 | +3519 | -3072 | +562 | +1009 | 大幅退化 |
| 0.15 | +3356 | -3292 | -974 | -910 | 亏损 |
| 0.20 | +2935 | -3672 | -1150 | -1887 | 亏损 |

## 结论：**不采用 B03**

### 关键发现
1. **止损 buffer 越小越好**——硬编码 ±1 优于所有动态方案
2. 即使 pct=0（buffer=pricetick=2），PnL 也从 +6764 下降到 +5909（-855）
3. 这证明 **Round 3 的 ±1 buffer 是最优的**——紧贴 stop_base 能最大化止损效率
4. buffer 增大后 p2209 退化最快，说明 p2209 合约对止损精度最敏感

### 操作
- **代码已恢复为硬编码 ±1**（不引入 stop_buffer_atr_pct 逻辑）
- `stop_buffer_atr_pct` 参数保留声明但不使用（未来如有需要可启用）
- 参数快照不变，维持 Round 3 最优

## 当前最优参数快照（不变）
```
atr_activate_mult = 2.5
atr_trailing_mult = 3.0
cooldown_losses = 4
cooldown_bars = 30
stop_buffer = ±1 (硬编码)
3S/2S: 15m MACD diff < 0 过滤
```

## 累计改善轨迹
| Round | 改动 | 合计 PnL | Δ |
|-------|------|---------|---|
| Baseline | 原始 | -8695 | - |
| R1 | 15m空头过滤 | +1993 | +10688 |
| R2 | ATR优化 | +3200 | +1207 |
| R3 | 连亏冷却 | +6764 | +3564 |
| **R4** | **止损buffer** | **+6764** | **+0（不采用）** |
