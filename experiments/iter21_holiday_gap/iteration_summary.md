# Iteration 21: Holiday Gap - Bridge Bar 方案

## 目标
研究节假日跳空对缠论分型的影响，并开发新方法来避免这种影响（不使用 S26/S27）。

## Phase 1: 结构审计

### 数据分析
- 总跳空事件: 2455
- 节假日跳空: 1694 (69.0%)
- 跳空延续率: 49.7%（接近随机）

### GPT-5.2 缠论审计结论
1. **停盘不破坏"相邻K线"定义** - 分型有效
2. **跳空不会让包含处理方向失效** - 只是改变统计分布
3. **108课口径**：缺口是"连接中枢的最低级别"
4. **跳空跨越中枢不等于中枢失效** - 需等笔完成确认

## Phase 2-3: Bridge Bar 方案

### 核心思想
把跳空显式建模为**最低级别走势连接段**，让序列在结构上连续。

### 实现
1. 检测跳空：`gap >= 1.5x ATR`
2. 插入 bridge bar：`open=prev_close, close=cur_open, high=max, low=min, is_bridge=True`
3. Bridge bar 参与包含处理和分型识别
4. 笔最小长度用 `real_count`（排除 bridge）

## Phase 4: 回测验证

| 合约 | 基线 | Bridge Bar | 差异 |
|------|------|------------|------|
| p2201 | -346.3 | -327.8 | +18.5 |
| p2205 | 2079.7 | 1937.3 | -142.4 |
| p2209 | 7728.6 | 7904.3 | +175.7 |
| p2301 | 162.7 | 225.0 | +62.3 |
| p2305 | -83.6 | -237.2 | -153.6 |
| p2309 | -279.1 | -228.8 | +50.3 |
| p2401 | -687.0 | -633.5 | +53.6 |
| p2405 | 712.5 | 712.5 | 0.0 |
| p2409 | 406.0 | 418.3 | +12.3 |
| p2501 | 1327.2 | 1546.5 | +219.3 |
| p2505 | 188.3 | -107.6 | -295.9 |
| p2509 | 250.1 | 344.2 | +94.0 |
| p2601 | 791.1 | 911.3 | +120.3 |
| **TOTAL** | **12250.1** | **12464.4** | **+214.3** |

## 结论
**Bridge Bar 方案有效**，总收益提升 214.3 pts (+1.7%)。

### 改善合约（9个）
- p2501: +219.3 pts（最大改善）
- p2209: +175.7 pts
- p2601: +120.3 pts
- p2509: +94.0 pts
- p2301: +62.3 pts
- p2401: +53.6 pts
- p2309: +50.3 pts
- p2201: +18.5 pts
- p2409: +12.3 pts

### 恶化合约（4个）
- p2505: -295.9 pts（最大恶化）
- p2305: -153.6 pts
- p2205: -142.4 pts
- p2405: 0.0 pts

## 新基线参数
```python
bridge_bar_enabled = True
bridge_gap_threshold = 1.5
```

## 待优化
1. 分析 p2505 恶化原因
2. 可能需要针对不同行情特征调整阈值
3. 考虑是否根据跳空方向调整策略行为
