# iter4 Phase 3: 修复策略 Backlog

## 背景
- 当前除p2209的6合约: 2825 pts (目标5600, 差2775)
- 负合约: 仅p2301(-605), 下跌7.8%行情做多
- 核心问题: 策略只做多，下跌/震荡合约无法避免亏损

## 优先级排序原则
1. 低风险 × 高影响 优先
2. 降频/过滤 > 信号逻辑修改
3. 减少亏损 > 增加盈利（止血优先）

---

## Backlog 条目

### R1: 连亏冷却增强 [低改动半径]
- **失败模式**: 所有合约都有严重连亏段(4-14连亏)
- **目标**: 连亏段缩短，减少震荡期反复入场
- **方案**: 当前cooldown_losses=2,cooldown_bars=20; 调整为更激进的冷却
  - 连亏3笔后暂停40根5m bar(~3.3小时)
  - 或加入当日亏损上限(daily_loss_limit)
- **代码改动点**: `_check_signal()` 冷却检查
- **预期影响**: p2301连亏减少(-100~-200pts亏损), 其他合约连亏段缩短
- **风险**: 低（只减少交易，不改信号逻辑）

### R2: 短交易过滤（最小持仓时长）[低改动半径]
- **失败模式**: 所有合约有≤5min短交易, 大概率是噪声
- **目标**: 消除无效短交易
- **方案**: 入场后最少持仓N根1m bar(如10), 在此期间不触发止损
  - 或: 入场确认延迟——分型完成后等1根5m bar确认
- **代码改动点**: `_check_stop_loss_1m()` 增加最小持仓时间
- **预期影响**: 减少2-6笔/合约的无效交易, 每合约+10~30pts
- **风险**: 低

### R3: 做空能力（3S/2S开空）[中改动半径]
- **失败模式**: p2301在下跌行情只做多,必然亏损
- **目标**: 下跌行情中能做空获利
- **方案**: 恢复3S/2S的开空功能（B09已改为仅平多）
  - 但只在15m明确空头(diff<dea且diff<0)时允许开空
  - 做空的止损用ATR上方
- **代码改动点**: `_check_signal()` 恢复Sell信号, `_check_stop_loss_1m()` 增加空头止损
- **预期影响**: p2301可能翻正(+600~1200pts), p2209也可能大幅提升
- **风险**: 中高（做空在震荡市可能引入新亏损）

### R4: 交易频率控制（p2501降频）[低改动半径]
- **失败模式**: p2501有142笔交易, commission占比28.5%
- **目标**: 减少低质量交易，降低手续费
- **方案**: 增加入场条件门槛
  - ATR_entry_filter提高(当前2.0→3.0)
  - 或信号间最小间隔(signal_interval >= 3根5m bar)
- **代码改动点**: `_check_signal()` ATR过滤
- **预期影响**: p2501交易减少30-50%, PF提升, +100~300pts
- **风险**: 低

### R5: 止盈增强（让赢的跑更久）[低改动半径]
- **失败模式**: 盈利交易avg win不够大（p2509: +42.5, p2501: +61.3）
- **目标**: 增大盈利交易的持仓时间和收益
- **方案**: ATR trailing更宽松
  - atr_trailing_mult从3.0→3.5或4.0
  - atr_activate_mult从2.0→2.5
- **代码改动点**: `_update_trailing_stop()` 参数
- **预期影响**: 大赢交易收益增加, 但可能增加回吐
- **风险**: 低

### R6: 15m级别增强过滤 [中改动半径]
- **失败模式**: 15m仅判断diff>dea, 震荡期频繁翻转
- **目标**: 更强的趋势确认
- **方案**: 
  - 加15m EMA(20/60)方向判断
  - 或15m MACD histogram趋势判断（连续N根同向）
- **代码改动点**: `_on_15m_bar()` + `_check_signal()` is_bull/is_bear
- **预期影响**: 震荡期减少入场, p2301/p2501受益最大
- **风险**: 中（可能过滤掉趋势初期信号）

---

## 实施顺序

### Round 1: R3 做空能力（优先级最高）
**理由**: 差距2775pts太大, 只靠降频/过滤最多补~1400pts. 恢复做空是唯一能大幅翻转p2301并显著提升整体的方案.
**预计影响**: p2301从-605→+200~600, p2209也可能提升, 合计+800~1800pts

### Round 2: R1+R2 连亏冷却+短交易过滤（打包）
**理由**: 低风险, 广泛受益
**预计影响**: 各合约+10~200pts, 合计+100~500pts

### Round 3: R4+R5 降频+止盈增强（打包）
**理由**: 专治p2501过度交易和弱合约PF偏低
**预计影响**: +200~500pts

### Round 4: R6 15m过滤增强
**理由**: 中改动, 需前面的改动稳定后再叠加
**预计影响**: +100~300pts

---

## 决策门 3 通过条件
- [x] Backlog输出完毕
- [x] 按优先级排序
- [x] 每条有: 失败模式→目标→方案→代码改动点→预期影响→风险
- → 进入 Phase 4 实现
