# iter7 Iteration Summary

## 目标
从 iter6 基线 (TOTAL=10191, 除p2209=3028, p2301=-504) 出发，通过结构性改变（非微调）提升弱合约表现。

## 方法
- Phase 1: 统计特征审计 + GPT-5.2 缠论108课结构审计
- Phase 3: 提取结构性改变 Backlog (S1-S7)
- Phase 4: 逐项实现与回测验证

## 采用的改动

### S1: 冷却期冻结 pending_signal
- `_check_entry_1m()` 增加冷却检查，Buy信号在冷却期清除
- 效果：安全修复，无变化

### S2b: 2B 结构闸门
- 2B/2S 仅在 `_active_pivot.state in ('forming', 'active')` 时允许
- 效果：p2501 +291pts, p2209 +47pts

### S5: 最小持仓保护 (min_hold_bars=2)
- 开仓后前2根5m bar止损距离加倍
- 效果：p2501 +252pts, p2301 +250pts, p2601 +112pts

### S4: 3B回踩深度限制 (max_pullback_atr=4.0)
- 3B回踩点必须 < ZG + 4×ATR（过滤追高假回踩）
- 效果：p2301 -225→-57, p2601 +106

### S7: 笔低点结构trailing (use_bi_trailing=True)
- trailing激活后用最近bi bottom作为止损参考
- 效果：p2301 -57→+25（翻正！）

## 否决的改动
- S2c(仅active允许2B): 过严，杀p2301/p2405
- S3(3B两步确认): 杀p2209(-7600pts)
- S5(min_hold=3): 杀p2209

## 结果对比

| 合约 | iter6 基线 | iter7 最终 | Delta |
|------|-----------|-----------|-------|
| p2601 | +1206.0 | **+1208.4** | +2 |
| p2405 | +1061.6 | **+865.9** | -196 |
| p2209 | +7163.2 | **+6739.2** | -424 |
| p2501 | +657.4 | **+1144.6** | +487 |
| p2505 | +448.1 | **+589.6** | +142 |
| p2509 | +158.8 | **+34.2** | -125 |
| p2301 | -504.0 | **+24.5** | +529 |
| TOTAL | 10191.0 | **10606.5** | +416 |
| 除p2209 | 3027.8 | **3867.3** | +840 |
| 负合约 | 1 | **0** | -1 |

## 新默认参数
```python
min_hold_bars = 2
max_pullback_atr = 4.0
use_bi_trailing = True
# S2b 写入代码逻辑（无参数开关）
```

## 关键教训
1. **2B结构闸门**是低成本高回报改动：仅一行条件就改善了p2501
2. **最小持仓保护**在所有合约上正向或中性：短持仓(<=2bar)全亏，加倍止损减少噪声出局
3. **3B两步确认太危险**：趋势合约(p2209)不能延迟入场
4. **回踩深度限制**和**笔低点trailing**联合使用让p2301翻正
5. 除p2209仍距目标5600差1733pts，下一步需要S6(2B背驰重写)这类更大的结构性改变
