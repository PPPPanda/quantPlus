# iter7 Phase 3: 结构性改变 Backlog

## 来源
- Phase 1 统计特征审计（diag_iter7.py）
- GPT-5.2 缠论108课结构审计
- iter1-6 历史经验

## 红线（不变）
1. ❌ 做空
2. ❌ 全局trade_interval降频
3. ❌ 15m diff>0硬过滤
4. ❌ 趋势过滤（中枢递降禁多）
5. ❌ 紧trailing（activate<2.0）

## 实验顺序

### S1: 冷却期冻结pending_signal [低改动]
**问题**: 断路器冷却期间,已挂起的pending_signal仍可在1m级别触发成交
**改动**: `_check_entry_1m()`开头增加冷却检查,冷却期间清空pending_signal
**预期**: p2301减少冷却期泄漏交易,+50-100pts
**风险**: 极低

### S2: 2B结构闸门—无活跃中枢时禁用2B [低改动]
**问题**: 2B(趋势延续)在无中枢/中枢碎片化时频繁触发(p2501有81笔2B)
**改动**: `_check_signal()`中2B路径增加条件:需要`_active_pivot`存在且state不为None
**预期**: p2501 trades降20-30%, p2301减少弱反弹追随. +200-500pts
**风险**: 可能损失p2601/p2505部分2B利润(需验证)

### S3: 3B两步确认—回踩后等一笔向上确认 [中改动]
**问题**: 3B在回踩bottom形成时立刻触发,但回踩可能未完成(假回踩)
         p2301的3B WR=13.6%(几乎全亏),p2209的3B PF=0.58(也亏)
**改动**: 
- 新增状态`_pending_3b_confirm`
- 3B条件满足时不直接设pending_signal,而是记录到confirm缓冲
- 下一笔形成时(向上笔):如果这笔的high > 回踩bottom的high → 确认3B
- 超时(>pivot_valid_range笔未确认) → 取消
**预期**: p2301 3B从PF=0.39→>1.0, p2501 trades降, +300-600pts
**风险**: 入场延迟~1笔(约30-45min),可能降低avg_win

### S4: 中枢离开增强—要求离开段力度足够 [中改动]
**问题**: 仅用"整笔高低点都在ZG上方"判定离开,在窄中枢时容易假离开
**改动**: 离开条件增加: 离开笔的幅度 >= 中枢宽度 * min_leave_ratio (如0.5)
**预期**: p2501/p2301减少假3B, +200-400pts
**风险**: 错过小中枢的有效离开(p2509中枢宽仅34)

### S5: 短持仓保护—最小持仓时长 [低改动]
**问题**: <=2bars交易占15-25%,全部亏损,占总亏损20-30%
**改动**: 开仓后前N根5m bar不检查止损(N=2或3,即10-15分钟)
         或: 前N根bar止损距离放宽到2x
**预期**: 减少噪声止损, +100-300pts
**风险**: 若真止损也会延迟,单笔亏损可能增大

### S6: 2B重写为真正背驰 [高改动]
**问题**: 当前2B是"diff增强+低点抬高"=趋势跟随加仓,不是缠论背驰
         在震荡市(p2301)反复误触发
**改动**: 
- 引入segment(走势段)概念: 连续同向笔构成一段
- 背驰比较: 当前段vs前同向段的MACD面积
- 面积衰竭(当前段面积<前段*threshold) + 价格创新高/低 → 背驰
- 背驰后反向笔确认 → 2B/2S
**预期**: 根本改善2B质量, p2501/p2301 trades大幅下降, +500-1000pts
**风险**: 改动最大,需要新数据结构,充分回测

### S7: Trailing改为笔低点结构止损 [中改动]
**问题**: ATR trailing不贴结构,可能过早被震出(窄中枢)或过晚(宽中枢)
**改动**:
- trailing激活后: 每形成新bottom,止损抬到该bottom.price - buffer
- 仍保持activate_mult=2.5门槛
- ATR trailing作为fallback(笔低点无法用时)
**预期**: p2509/p2505 avg_win提升, +200-400pts
**风险**: 在快速回撤行情中,笔低点可能太远(止损太松)

## 实验计划

| Round | 改动 | 预期增量 | 累计除p2209 |
|-------|------|---------|-------------|
| R1 | S1(冷却冻结) | +50-100 | 3078-3128 |
| R2 | S2(2B结构闸门) | +200-500 | 3278-3628 |
| R3 | S5(短持仓保护) | +100-300 | 3378-3928 |
| R4 | S3(3B两步确认) | +300-600 | 3678-4528 |
| R5 | S4(离开力度) | +200-400 | 3878-4928 |
| R6 | S7(结构trailing) | +200-400 | 4078-5328 |
| R7 | S6(2B背驰重写) | +500-1000 | 4578-6328 |

**乐观路径**: 除p2209 > 5600 ✅
**保守路径**: 除p2209 ~ 4000-4500 (仍需后续迭代)
