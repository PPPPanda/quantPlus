# iter6 Phase 3: 修复 Backlog（主控+GPT汇总）

## 核心策略转变
**放弃"改信号逻辑"路线，转向"风控分治+退出优化"路线**
- iter4/5证明：改信号（趋势过滤、中枢状态机、背驰绑定）效果微弱或灾难
- 新方向：不动入场逻辑，通过"按合约分治的风控闸门+退出增强"提升

## 红线（不可重复）
1. ❌ 做空
2. ❌ 全局trade_interval
3. ❌ 15m diff>0硬过滤
4. ❌ 趋势过滤（中枢递降禁多）
5. ❌ 紧trailing（activate<2.0）

---

## Backlog

### R1: 同中枢入场去重 [p2501重点] — 低改动
**目标**: p2501 trades 291→150-180，PnL +606→+1200+
**逻辑**: 
- 记录每个中枢(ZG/ZD区间)的入场次数
- 同一中枢最多允许 `max_pivot_entries=2` 次入场
- 第3次及以后需要突破中枢上沿+0.6*ATR才放行
**代码改动**: `_check_signal()` 增加 pivot entry_count 检查
**预期**: p2501 -50% trades, +100% PnL/trade
**风险**: 低。p2601/p2209 中枢不重复，不受影响

### R2: 连亏断路器（按合约独立） [p2301重点] — 低改动
**目标**: p2301 -605→0（截断14连亏）
**逻辑**:
- 按合约独立计数连亏（不影响其他合约）
- loss_streak >= L1(6): 入场需更强确认（突破前高+N ticks）
- loss_streak >= L2(10): 暂停该合约 pause_bars 根5m bar
- 解除: 出现盈利交易(>1R) 或 暂停期满
**注意**: 当前B12已有cooldown_losses=2, cooldown_bars=20，但太激进。改为更温和的分层
**代码改动**: `_check_signal()` 和 `_check_entry_1m()` 增加分层断路器
**预期**: p2301 连亏从14→6，PnL从-605→-200~0
**风险**: 可能影响p2209（也有7连亏），但p2209赢单大，1R解除快

### R3: 两段式出场 [p2509重点] — 中改动  
**目标**: p2509 avg_win 42.5→60-70，PnL +137→+400-600
**逻辑**:
- Phase 1: 浮盈<1R时用初始止损（不trailing）
- Phase 2: 浮盈≥1R时，止损抬到 entry+0.2*ATR（小幅锁盈）
- Phase 3: 浮盈≥2R时，启用松trailing（基于5m笔低点而非固定ATR倍数）
- 不改activate_mult/trailing_mult默认值（保护p2601）
**代码改动**: `_update_trailing_stop()` 重写为分阶段逻辑
**预期**: p2509/p2505 avg_win提升30-50%
**风险**: p2601可能略受影响（需验证）

### R4: 波动率自适应止损距离 — 低改动
**目标**: 减少短交易占比（36%→20%），改善p2301/p2501
**逻辑**:
- stop_buffer = max(pricetick, atr * stop_buffer_pct)
- stop_buffer_pct 从固定0.02改为 = base_pct * (1 + vol_scale * normalized_atr)
- 高波动时止损拉远（不被震出），低波动时止损收紧（保护小赢）
**代码改动**: `_calc_stop_buffer()` 增加波动率缩放
**预期**: 减少假止损，短交易占比下降
**风险**: 高波动时单笔亏损增大

---

## 实验顺序

| Round | 改动 | 目标合约 | 预期增量 |
|-------|------|---------|---------|
| R1 | 同中枢入场去重 | p2501 | +600~1200 |
| R2 | 连亏断路器 | p2301 | +400~600 |
| R3 | 两段式出场 | p2509/p2505 | +300~600 |
| R4 | 波动率自适应止损 | 全合约 | +100~300 |

**预计总增量**: +1400~2700（加上已有2825=4225~5525）
**乐观估计可接近5600目标**

## Phase 3 决策门
- [x] 两方审计汇总 ✅
- [x] Backlog排序 ✅
→ 进入 Phase 4 实现
