# Phase 1 审计汇总：节假日跳空对缠论分型的影响

## 三方审计参与者
1. **我（主控）**：代码层面审计
2. **Claude 子代理**：技术分析数据审计
3. **GPT-5.2 子代理**：缠论 108 课视角审计（进行中）

---

## 1. 数据分析结论

### 1.1 总体统计
- 总跳空次数: 69
- 节假日跳空: 7 次
- 普通周末跳空: 62 次

### 1.2 跳空方向与分型一致性
| 类型 | 顺势率 | 说明 |
|------|--------|------|
| 整体 | **85.5%** | 跳空方向与首个分型一致 |
| 节假日跳空 | **71.4%** | ⚠️ 一致性明显更低 |
| 普通周末跳空 | **87.1%** | 相对可靠 |

**核心发现**：节假日跳空的分型一致性比普通周末**低 15.7%**，说明节假日跳空确实对分型识别造成"噪音"。

### 1.3 跳空幅度与分型延迟
| 跳空幅度 | 次数 | 平均延迟 | 即时率 |
|----------|------|----------|--------|
| 小(<0.5%) | 47 | 2.7分钟 | 72.3% |
| 中(0.5-1%) | 16 | 2.8分钟 | 68.8% |
| **大(>1%)** | **6** | **4.2分钟** | **50.0%** |

**核心发现**：大跳空（>1%）的分型延迟更高，即时率仅 50%。

### 1.4 极端案例
| 合约 | 日期 | 跳空幅度 | 首个分型 | 延迟 |
|------|------|----------|----------|------|
| p2601 | 2025-10-09 | +2.45% | top | 0min |
| p2401 | 2023-10-09 | -2.12% | bottom | 5min |
| p2209 | 2022-05-05 | -1.71% | bottom | 5min |

---

## 2. 代码层面审计结论

### 2.1 当前实现问题
1. **时序问题**：跳空检测在 `_process_inclusion()` 之前，但跳空 K 线仍参与包含处理
2. **方向污染**：跳空后 `_inclusion_dir` 可能与真实趋势不一致
3. **分型失真**：跳空 K 线的极端高低点扭曲分型判定

### 2.2 S26/S27 的局限
- S26（冷却期）只阻止信号生成，不解决分型结构问题
- S27（重置方向）默认禁用，且仅重置方向不影响跳空 K 线本身

---

## 3. 新方案建议（不使用 S26/S27）

### 方案 A：跳空后延迟判定（推荐优先级 1）
```
思路：跳空后等待 N 根 K 线确认，再进行分型判定
参数：gap_confirm_bars = 2
实现：跳空后 _gap_confirm_pending = N，期间跳过 _process_bi()
预期：避免基于跳空 K 线做出错误分型判断
风险：可能错过快速反转机会
```

### 方案 B：分型置信度机制（推荐优先级 2）
```
思路：跳空后形成的分型降低置信度，需要更严格的条件
实现：
  - 标记 bar['is_gap'] = True
  - 分型判定时检查相关 K 线是否包含跳空 K 线
  - 如果是，要求更大的 min_bi_gap
预期：动态调整，不完全排斥跳空分型
风险：增加逻辑复杂度
```

### 方案 C：包含方向强制重置（推荐优先级 3）
```
思路：跳空时强制重置 _inclusion_dir = 0，并等待方向确认
参数：gap_force_reset = True
实现：
  - 检测到跳空 → _inclusion_dir = 0
  - 后续 K 线按 R1 规则从价格关系推导方向
预期：避免方向污染
风险：与 S27 类似，需要回测验证
```

### 方案 D：虚拟 K 线填充（推荐优先级 4）
```
思路：用跳空幅度估算缺失的 K 线，填充到序列中
实现：创建虚拟 bar，high/low 设为 prev_close 和 gap_open 的中间值
预期：保持 K 线序列连续性
风险：引入虚拟数据噪音，最复杂
```

---

## 4. 决策门 1 结论

### 核心问题确认
✅ **节假日跳空确实对分型识别造成噪音**
- 节假日跳空的分型一致性（71.4%）明显低于普通周末（87.1%）
- 大跳空的分型延迟更高，即时率只有 50%

### 推荐进入 Phase 2 的方案
按优先级排序：
1. **方案 A（延迟判定）**：最小改动，风险可控
2. **方案 B（置信度）**：更精细，需要回测验证
3. **方案 C（方向重置）**：与 S27 类似但更激进
4. **方案 D（虚拟填充）**：最复杂，风险最高

### 待 GPT-5.2 审计
- 缠论 108 课对跳空的处理原则
- 从缠论角度验证上述方案的合理性
