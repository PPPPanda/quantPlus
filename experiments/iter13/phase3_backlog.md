# Iteration 13 Phase 3 — 修复方案 Backlog

## 目标
- p2401 从 -672.9pts 改善到 >-180pts（或尽量接近）
- TOTAL ≥ 12164.2pts（不下降）
- 不伤 p2209/p2601

---

## Backlog（按优先级排序）

### S14: SMA偏离度上限过滤（P0 — 立即实施）
- **失败模式**：p2401 在7500+入场14笔全部亏损，因为5m信号在大级别空头中逆势开多
- **目标**：过滤高位做多，减少"追高"亏损
- **方案**：新增 `max_sma_deviation` 参数，价格超过 SMA 一定比例时禁止 Buy
- **代码改动点**：`_check_signal()` S13 块
- **缠论依据**：价格远离均值="离开段末端"，缠论中不追高位买点
- **预期影响**：p2401 回收 200-350pts；p2209/p2601 应无影响（趋势中价格持续高于SMA是正常的，但偏离度不会极端）
- **风险**：如果趋势行情中价格持续高位，可能错过突破。需选合适偏离度阈值

### S15: 15m diff 绝对值门槛（P1）
- **失败模式**：7200-7500区间 31笔-966pts，15m diff>dea 但实际处于弱多头/震荡
- **目标**：过滤"假多头"（diff>dea 但diff值很小）
- **方案**：新增 `min_diff_15m_pct` 参数，要求 diff_15m / price > 阈值
- **代码改动点**：`_check_signal()` is_bull 判断处
- **预期影响**：p2401 减少 30-40% 无效入场
- **风险**：趋势初期 diff 也小，可能延迟入场

### S16: ATR波动率门槛启用（P2）
- **失败模式**：p2401 低波动期频繁被扫损
- **目标**：低波动环境不交易
- **方案**：启用已有参数 `min_atr_pct`，设为 0.008~0.012
- **代码改动点**：无需改代码，仅调参
- **预期影响**：p2401 减少低波动期亏损
- **风险**：可能漏掉低波动起涨

### S17: 条件性做空（P3 — 独立实验线）
- **失败模式**：纯做多在持续下跌中无法获利
- **目标**：在极严格条件下允许做空
- **方案**：要求 ≥2个中枢递降 + close<SMA + diff<dea 三重确认
- **代码改动点**：`_check_signal()` 3S/2S 分支 + `_open_position(-1)`
- **预期影响**：p2401 可能在9月下跌中获利
- **风险**：可能伤 p2209；改动半径中等
- **验证前提**：必须先验证 p2209 不退化

---

## Phase 4 执行计划

### 小循环 1: S14 SMA偏离度
1. 实现 `max_sma_deviation` 参数
2. p2401 单合约网格搜索：deviation = [0.015, 0.020, 0.025, 0.030]
3. 最优值全量 13 合约回归

### 小循环 2: S14 + S15 组合
1. 在 S14 最优值基础上加 `min_diff_15m_pct`
2. 网格搜索 + 13 合约回归

### 小循环 3: S14 + S15 + S16 组合
1. 加 ATR 门槛
2. 13 合约回归

### 小循环 4: S17 条件性做空（独立线）
1. 实现三重条件做空
2. 先跑 p2209 验证
3. 如果 p2209 pass 则跑 13 合约
