# iter8 总结

## 基线
- TOTAL=11117.3 pts | 除p2209=4179.7 | 目标 5600
- 含 iter7 全部改动: S2b(2B gate) + S5(min_hold_bars=2) + S4(max_pullback_atr=4.0) + R2(cb=6/60) + S6(div_mode=1, div_threshold=0.50)

## 核心目标
将2B/2S从"diff点值比较"升级为"走势段MACD面积力度比较"（segment divergence），在缠论框架内实现真正的背驰判定。

## 实验记录

### Phase 3: 2B/2S 改造方案设计
- `phase3_2b_design.md`: GPT-5.2 产出完整设计（段定义、力度比较、伪代码、风险分析）
- `phase1_2b_design_claude.md`: Claude 简化渐进式方案

### Phase 4: 实验（全部失败）

| 实验 | 描述 | TOTAL | 除p2209 | 结论 |
|------|------|-------|---------|------|
| test_s8_default | 段背驰替代原2B（bug版：10段/818笔） | -281 | -4460 | ❌ 段构建bug |
| test_s8_addon | 段背驰补充入场（bug修复后） | 10407 | -710 | ❌ 生成垃圾信号 |
| test_s8_confirm | 段背驰+AND确认 | 10959 | -158 | ❌ 仍微退化 |
| test_s8_coexist | 段背驰+S6共存+OR确认 | 10488 | -629 | ❌ p2501暴跌 |
| test_s8_exit_only | 段背驰仅做出场 | 9185 | -1932 | ❌ p2501灾难 |
| test_s8_filter | 段力度递增过滤2B | 9482 | -1635 | ❌ 杀p2209 |
| test_s8v2_addon | 修复段构建后重测补充入场 | 10407 | -710 | ❌ |
| test_s8v3_filter_bi3 | 段长度<3阻止2B | 9635 | -1482 | ❌ 杀p2601 |
| hist_gate=1 | 2B需hist>0 | 7767 | -3350 | ❌ 过滤过猛 |
| hist_gate=2 | 2B需hist上拐 | 9790 | -1328 | ❌ |

### 参数调优（有限改善）

| 参数组合 | TOTAL | 除p2209 | 变化 | Neg |
|---------|-------|---------|------|-----|
| **基线 cb=6/60** | **11117** | **4180** | — | None |
| cb=7/70 | 11551 | 4112 | +434 / -68 | None |
| cb=8/80 | 11511 | 4071 | +394 / -108 | None |
| cb=7/70+cd=3/15 | 11854 | 3731 | +737 / -449 | p2301,p2509 |
| div_mode=0 | 9690 | — | -1427 | None |
| trailing=1.8 | 9071 | — | -2047 | p2301 |
| trailing=2.2 | 9762 | — | -1356 | p2301 |

## 段构建Bug修复
- **问题**: 极值追踪用全局max/min，导致818笔只生成10段（平均82笔/段）
- **修复**: 改为追踪前一个同类端点价格。修复后208段、平均3.9笔/段
- **但修复后段背驰仍然无效**（信号质量差、不适用于这些合约的走势特征）

## 关键发现

1. **段背驰入场信号不可靠**: "价格创新低+MACD面积衰减"不能有效预测反转时点
2. **段背驰出场信号破坏性**: 过早平仓导致更多交易（重新入场成本高）
3. **段信息做过滤也无效**: 无论过滤段长度、段力度递增，都在杀掉好信号
4. **参数调优收益递减**: 所有单参数调整最多只能改善p2209（已经很好的合约）
5. **架构天花板**: 当前2B/3B信号框架在弱合约（p2301, p2509）上表现差，根本原因是这些合约的行情特征（震荡/低波动）不适合该策略

## 当前最优配置（未变更，维持iter7基线）
```
circuit_breaker_losses=6, circuit_breaker_bars=60
min_hold_bars=2, max_pullback_atr=4.0
div_mode=1, div_threshold=0.50
use_bi_trailing=True
```

## 下一步建议
1. **接受架构天花板**: 除p2209≈4180已接近这套信号体系的极限
2. **转向其他方向**: 
   - 考虑增加新合约（可能有更适合这个策略的标的）
   - 考虑多策略组合（不同策略覆盖不同行情类型）
   - 考虑更高级别的信号（15m/60m 层面的买卖点）
3. **代码清理**: 移除无效的S8段背驰代码，保持代码简洁
